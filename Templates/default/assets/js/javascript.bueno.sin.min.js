$(document).ready(function(){
	remove_flash();
	_confirm();
	lightbox();
	password();
	$('.tooltip').tooltip();
	radio_select();
	tooltip();
	edit();
});

function edit(){
	var element 	=	$(".btn-edit");
	if(element.length>0){
		element.each(function(index,v){
			if($(v).data("form")){
				$(v).click(function(){
					parent	=		$(v).parent("div");
					parent.addClass("active");
					parent.find(".toggle").toggle();
					parent.find(".close-toggle").unbind( "click" );
					parent.find(".close-toggle").click(function(){
						parent.find(".toggle").toggle();
					})
				})
			}
		})
	}
}

function toggle(){
	var element 	=	$(".btn-edit");
	if(element.length>0){
		element.each(function(index,v){
			console.log(v)
		})
	}
}

function tooltip(){
	$('.btn-tooltip').tooltip();
}

function radio_select(){
	if($(".radio_select").length>0){
		$(".radio_select").each(function(k,v){
			$(this).find("input[type='radio']").hide();
		});
	}
}

function get_post(div){
	$.post(div.data("url"),div.data(),function(data){
		if(data.response){
			$(".num_results").html(data.response.total);
			$.each(data.response.data, function(k2,v2){
				clone_items1(v2,clone.clone(),div);
			});
			start 	=	 parseInt(div.data("start"))
			div.attr("data-start", start + 10 );
			clone.hide();
		}else{
			clone.find(".loading").remove();
			clone.find(".content_listado").html('<div class="text-center"><i class="far fa-tired fa-5x"></i> <br/>No results have appeared</div>');
		}
	},"json").always(function() {
    	//alert( "finished" );
    	div.data("status",0);

  	});
}

function search_in_object(rows,_search){
	/*LO QUE BUSCABA PARA EL RETURN EN JS*/
	var obj = $.grep(rows, function(obj){ return obj.id === _search;})[0];
	return obj;
}

function password(){
	$("#submit_pass").addClass("disabled");
	var inputs	= $("[password=true]");
	if(inputs.length>0){
		inputs.each(function(index,v){
			$(this).attr("type","password");
			$(this).keyup(function(){
				if($(this).val()!=''){
					disabled($(this));
				}
			});
		})
	}
}

function disabled(obj){
	if(obj.val()!=$("#"+obj.data("rel")).val()){
		$("#submit_pass").addClass("disabled");
	}else{
		$("#submit_pass").removeClass("disabled");
	}
}

function submit_via_ajax(){
	$("form[ajax]").each(function(index,v){
		var form	=	$(this);
		if(parent.$(".submit").length>0){
			parent.$(".submit").click(function(){
				form.submit();
				setTimeout(function(){ parent.$modal.modal('hide');}, 3000);
			});
		}
	})
}

function DataTable(){
	var newURL 		=	$(location).attr('href');
	var columnas	=	$('#perfiles thead th')
	var descripcion	=	[];
	columnas.each(function(index,v){
		descripcion[index]	=	{"data": $(v).data("columna")};
	})
	var order	=	$('#perfiles').data("order");
	var desc	=	$('#perfiles').data("desc");
	if(!order){order=0;}
	if(!desc){desc="asc";}else{desc="desc";}
	var table		=	$('#perfiles').DataTable({
		ajax: newURL,
		"processing": true,
		"serverSide": true,
		"language": {
			"url": $("body").data("lang")
		},
		"order": [[ order, desc ]],
		"columns": descripcion
	});

	if($('#perfiles').hasClass( "openmodal" )){
		$('#perfiles tbody').on( 'click', 'a', function () {
			make_modal_ajax($(this));
			return false;
		});
	}
	$('#perfiles tbody').on( 'click', 'input', function () {
		$(this).unbind('keyup');
		$(this).keyup(function(e){
			var elem=$(this);
			if(e.which == 13) {
				$.post($(this).attr("href"),{receta_id:$(this).attr("data-recetaid"),cantidad_entrada:$(this).val()},function(data){
					if(data.cantidad){
						elem.parent("td").parent("tr").find("td .inventario_nuevo").html(data.cantidad);
						elem.val('');
					}
				},'json')
			}
		});
		return false;
	});
	return table;
}

function format_num(){
	$(".format_num").number( true, 2 );
}

function error(title,message){
	make_message(title,message);
	return false;
}

function make_message(title,message,size,height){
	if(!size){
		size	=	'modal-sm';
	}
	if(!height){
		height	=	'450';
	}
	$modal			=	modal.clone();
	var contenido  	=	$modal.find(".modal-dialog").find(".modal-content");
		$modal.addClass("pgrw_modal_confirm_ajax").attr("aria-labelledby","modalLabel_confirm_ajax").find(".modal-dialog").addClass(size);
		contenido.find(".modal-header").html("<h5>"+title+"</h5>");
		contenido.find(".modal-footer").html('<button type="button" class="btn btn-warning cancelar" data-dismiss="modal">Cerrar</button>');
	$("body").append($modal);
	$modal.find(".modal-body").html('<div class="text-center"> '+message+'</div>');
	$modal.modal({ keyboard: false})
}

function post_ajax(form){
	$.post(form.attr("action"),form.serialize(),function(data){
	},'json').fail(function() {
		alert("Error consulte al administrador de sistemas");
	}).always(function(data) {
		if(data.message){
			alert(data.message);
		}
		if(data.code==200){
			$("[input_dinamico]").attr("readonly","readonly").unbind( "keypress" );
			if( data.redirect ){
				setInterval(function(){ document.location.href	=	data.redirect.val(); }, 2000);
			}
		}
		if(data.callback){
			eval(data.callback);
		}
	});
}

var	modal	=	$('<div class="modal fade " tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"></div><div class="modal-body"></div><div class="modal-footer"></div></div></div></div>');
/*MODAL */
function lightbox(){
	btns	=	$(".lightbox");
	btns.each(function(index,v){
		var btn =	$(v);
		btn.click(function(event){
			make_modal_ajax(btn);
			return false;
		})
	});
}

function make_modal_ajax(obj){
	var size		=	obj.data("size");
	var height		=	obj.data("height");
	var btnsuccess	=	obj.data("btnsuccess");
	if(btnsuccess){
		var btn_save	=	$('<button type="button" class="btn btn-primary submit"><i class="fas fa-save"></i> Guardar</button>')
	}else{
		var btn_save	=	$('<div/>');
	}
	if(!size){
		size	=	'modal-lg';
	}
	if(!height){
		height	=	'400';
	}

	$modal			=	modal.clone();
	var contenido  	=	$modal.find(".modal-dialog").find(".modal-content");
		$modal.addClass("pgrw_modal_confirm_ajax").attr("aria-labelledby","modalLabel_confirm_ajax").find(".modal-dialog").addClass(size);
		contenido.find(".modal-header").html("<h5>"+'<i class="fas fa-info-circle"></i> ' +obj.attr("title")+"</h5>");
		contenido.find(".modal-footer").html('<button type="button" class="btn btn-danger cancelar" data-dismiss="modal"><i class="fas fa-window-close"></i> Cerrar</button>');
		if(obj.data("form")){contenido.find(".modal-footer").prepend(btn_save);}
	$("body").append($modal);
	$modal.find(".modal-body").html('<div class="text-center"><i class="fa fa-cog fa-spin fa-3x fa-fw"></i><span class="sr-only">Loading...</span></div>');
	if(obj.data("type")=='iframe'){
		$iframe		=	$('<iframe src="'+obj.attr("href")+'" allowfullscreen="" frameborder="0" width="100%" height="100%" />');
		$modal.find(".modal-body").css("height",height+"px").html($iframe);
	}else if(obj.data("type")=='ajax'){
		$.post(obj.attr("href"),{},function(data){
			$modal.find(".modal-body").height(height).html(data);
			$.pgrwForms();
		})
	}
	$modal.modal({ keyboard: true}).on('hidden.bs.modal', function (e) {
   		$modal.remove();
	})
}


/*MODAL END */

function pgrw_ajax(){
	var elem	=	$("[pgrw-ajax]");
	elem.each(function(index,v){
		var element		=	$(v);
		var atributos	=	element.attr("pgrw-ajax");
		atributos 		= 	eval("("+atributos+")");
		var contenedor	=	atributos.contenedor;
		var url			=	atributos.url;
		element.change(function(){
			$.post(url,{id:$(this).val()},function(data){
				$(contenedor).empty();
				$(contenedor).html(data);
			})
		})
	});
}

function form_ajax(){
	var elem	=	$("[ajax]");
	elem.each(function(index,v){
		var form		=	$(v);
		form.submit(function( event ) {
			var feedback				=	contenedor_message.clone();
			form.find('[require]').each(function(indice,objeto){
				var	input				=	$(objeto);
				var grand_contenedor	=	input.parent("div").parent("div.form-group");
				if(input.val()==''){
					if(grand_contenedor.find(".contenedor_message").length==0){
						feedback.find(".form-control-feedback").html(message.form_require);
						grand_contenedor.addClass(hasestatus.danger).find("div").append(feedback);
						fx(feedback);
						input.focus().addClass(formcontrol.danger);
					}
					return false;
				}
			});
			return false;
		});
	});
}

function _confirm(){
	var obj			=	$("[confirm='true']");
	obj.each(function(index,v){
		var elem	=	$(v);
		elem.click(function(){
			if(confirm("EstÃ¡ seguro de borrar este registro?")){
			}else{
				return false;
			}
		});
	});
}

function _post(){
	$.post(elem.attr("href"),function(data){

	},'json').fail(function() {
		alert("Error consulte al administrador de sistemas");
	}).always(function(data) {
		if(data.message){
			alert(data.message);
		}
		if(data.code==200){
			var redirect = elem.find('[name="redirect"]');
			if( redirect.length >0){
				setInterval(function(){ document.location.href	=	redirect.val(); }, 2000);
			}
		}
		if(data.callback){
			eval(data.callback);
		}
	});
}

function reloader_iframe(){
	parent.location.reload();
	//window.opener.location.reload()
	//document.location.reload();
}

function remove_flash(){
	var elem		=	$("#flash");
	var contenido	=	elem.find("div");
	if(elem.find("div").length>0){
		setTimeout(function(){contenido.addClass("animated fadeOutUp");elem.html("");}, 3500);
	}
}

function fx(obj,fx){
	if(!fx){fx	=	'bounceIn';}
	obj.addClass("animated animated "+fx+" active");
	setTimeout(function(){obj.removeClass("animated animated bounceIn");}, 1000);
}
